@model ProductDemoApplication.Models.PurchaseTransactionDetailsCreateEditDelete

<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script type="text/javascript">
   
    function FillProduct() {
        $("#txtRate").val("");
            var ProdId = $("#ProductCat").val();
            $.ajax({
                url: '/PurchaseTransaction/FillProduct',
                type: "POST",
                dataType: "JSON",
                data: { Product: ProdId },
                success: function (categories) {
                    $("#Product").html("");
                    $.each(categories, function (i, category) {
                        $("#Product").append(
                            $('<option></option').val(category.Id).html(category.Name));
                       
                    });
                }
            });
        }

        function FillText() {
            var ProdCatId = $("#Product").val();
           
            $.ajax({
                url: '/PurchaseTransaction/FillText',
                type: "POST",
                datatype: "JSON",
                data: { prodctCat: ProdCatId },
                success: function (products) {
                  
                    $("#txtRate").html("");
                    $.each(products, function (i, product) {
                        $("#txtRate").val(product.Rate);
                    });

                }
            });
        }
     
        $(".ClassEdit").click(function (e)
        {
            alert("hello");
                debugger;
                var ProductID = $("#Product").val();
                alert(ProductID);

                var $tr = $(this).closest("tr");

            var val = $tr.find("td").eq(0).html();
    
                $("#txtEditProductId").val(val);
                $("#txtEditQuantity").val($tr.find("td").eq(1).html());
                $("#txtEditRate").val($tr.find("td").eq(2).html);
                ShowDialog(true);
                e.preventDefault();
            });
       
        
        $("#btnSubmit").click(function (e) {
            $("#txtDeleteValue").val(val);
            HideDialog();
        });
        function ShowDialog(modal)
        {
            debugger;
            $("#overlay").show();
            $("#dialog").fadeIn(300);

            if (modal) {
                $("#overlay").unbind("click");
            }
            else {
                $("#overlay").click(function (e) {
                    HideDialog();
                });
            }
        }
        function HideDialog() {
            $("#overlay").hide();
            $("#dialog").fadeOut(300);
        }
        $("#txtDeleteValue").hide(true);

        $("#Delete").click(function ()
        {
            debugger;
            var $tr = $(this).closest("tr");
            var val = $tr.find("td").eq(0).html();
            if (confirm("Are you sure to delete this record?"))
                $("#txtDeleteValue").val(val);
            else
                return false;
        });
        $(function () {
            $("#Product").change(function () {
                var ProductID=$(this).val();
            });
        });
        
</script>
<h2>Create</h2>
<style type="text/css">
   .web_dialog_overlay {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
        background: #313131;
        opacity: .90;
        filter: alpha(opacity=25);
      
        z-index: 101;
        display: none;
    }

    .web_dialog {
        display: none;
        position: fixed;
        width: 380px;
        height: 300px;
        top: 50%;
        left: 50%;
        margin-left: -190px;
        margin-top: -100px;
        background-color: #313131;
        border: 2px solid white;
        padding: 0px;
        z-index: 102;
        font-family: Verdana;
        font-size: 10pt;
    }

    .web_dialog_title {
        border-bottom: solid 2px white;
        background-color:skyblue;
        padding: 4px;
        color: White;
        font-weight: bold;
    }

        .web_dialog_title a {
            color: White;
            text-decoration: none;
        }

    .align_right {
        text-align: right;
    }

    tr.d0 td{
        background-color :skyBlue;
    }

    tr.d1 td{
        background-color :#e9edf4;
    }
    #textboxesIP{
        margin-left:40px;
    }
    #brands{
        color:white;
        font-family:'Comic Sans MS';
        font-size:15px;
    }
</style>
@using (Html.BeginForm()) 
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">
        
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            @Html.Label("Customer Name", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownList("CustomerName", null, "---Select Customer---", htmlAttributes: new { @class = "form-control" })

               @* @Html.HiddenFor(model=>model.)*@
                
                @Html.ValidationMessageFor(model => model.CustomerName, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.Label("Product Category", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownList("ProductCategoryId",null, "---Select Product Category---", htmlAttributes: new { @class = "form-control",@onchange="FillProduct()", @Id = "ProductCat" })
                @Html.ValidationMessageFor(model => model.ProductId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
      
            @Html.Label("Product Name", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownList("ProductId", new SelectList(Enumerable.Empty<SelectListItem>(),"Id","Name"),"---Select Product---", htmlAttributes: new { @class = "form-control",@Id="Product",@onchange="FillText()"})
                 @Html.HiddenFor(Model=>Model.ProductName)
                 @Html.ValidationMessageFor(model => model.ProductId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Rate, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Rate, new { htmlAttributes = new { @class = "form-control",@Id="txtRate"} })
               @Html.ValidationMessageFor(model => model.Rate, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Quantity, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.Quantity, new { htmlAttributes = new { @class = "form-control" ,@Id="txtQty"} })
               @Html.ValidationMessageFor(model => model.Quantity, "", new { @class = "text-danger" })
            </div>
        </div>  
    </div>
    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="AddProduct" class="btn btn-success" id="btnAddProduct" name="command" />
        </div>
    </div>

        @*<div id="output"></div>

        <div id="overlay" class="web_dialog_overlay"></div>
        <div id="dialog" class="web_dialog">
            <table style="width: 100%; border: 0px;" cellpadding="3" cellspacing="0">
                <tr>
                    <td class="web_dialog_title">Update Product Information </td>

                </tr>

                <tr>

                    <td colspan="2" style="padding-left: 15px;">*@
                        @* <hr style="color:skyblue" />*@
                        @*<div id="brands">
                            <table>
                                <tr>
                                    <td>Product Id</td>
                                    <td>@Html.TextBox("txtEditProductId", "", htmlAttributes: new { @readonly = "true", @class = "txt" })</td>
                                </tr>

                                <tr>
                                    <td>Quantity</td>
                                    <td>@Html.TextBox("txtEditQuantity", "", htmlAttributes: new { @class = "txt" })</td>
                                </tr>

                                <tr>
                                    <td>Rate</td>
                                    <td>@Html.TextBox("txtEditRate", "", htmlAttributes: new { @class = "txt" })</td>
                                </tr>


                            </table>
                        </div>
                    </td>*@
                @*</tr>

                <tr>
                    <td colspan="2" style="text-align: center;">
                        <input id="btnSubmit" type="submit" name="Command" value="Update" />
                    </td>
                </tr>
            </table>
        </div>*@

        @*<div id="ProductArea" class="table">

            </div>*@
        <table id="tblProdDetails">
            @if (ViewData["data"] != null)
            {
                <tr style="border:none;" align="Center">
                    <td align="center" style="border:none">
                        @Html.TextBox("txtDeleteValue", "", htmlAttributes: new { style = "display:none" })
                    </td>
                </tr>
                <tr style="background-color:#336699;color:white">
                    <th width="10%">Product Id</th>
                    <th width="10%">Quantity</th>
                    <th width="10%">Rate</th>
                   
                </tr>
                int count = 1;
                string csname = "";
                foreach (System.Data.DataRow dt in (ViewData["data"] as System.Data.DataTable).Rows)
                {
                    count++;


                    if (count % 2 == 0)
                    {
                        csname = "d0";
                    }
                    else
                    {
                        csname = "d1";
                    }
                    <tr class="@csname">
                        <td>@dt[0]</td>
                        <td>@dt[1]</td>
                        <td>@dt[2]</td>

                        @*<td>
                            <input type="submit" id="Edit" name="Command" value="Edit" class="ClassEdit" />
                            <input type="submit" id="Delete" name="Command" value="Delete" />
                        </td>*@
                    </tr>
                }
            }
        </table>
}

@*<div>
    @Html.ActionLink("Back to List", "Index")
</div>*@

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
